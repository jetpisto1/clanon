import os
import discord
import random
import json
from discord.ext import commands


PREFIX = '-'
# í™˜ê²½ ë³€ìˆ˜ì—ì„œ í† í° ê°’ ì½ì–´ì˜¤ê¸°



# ì‚¬ìš©ì í¬ì¸íŠ¸ë¥¼ ì €ì¥í•  ë”•ì…”ë„ˆë¦¬
user_points = {}
client = discord.Client()
client = commands.Bot(command_prefix='-')

@client.event
async def on_ready():
    print(f'ë´‡ ì´ë¦„: {client.user.name}')
    print(f'ë´‡ ID: {client.user.id}')

@client.event
async def on_message(message):
    if message.author == client.user:
        return

    if message.content.startswith('-íŒ€'):
        # ì…ë ¥í•œ ë‹¨ì–´ ëª©ë¡ í™•ì¸
        content = message.content.split(' ', 1)
        if len(content) != 2:
            await message.channel.send('âš ï¸ ì˜¬ë°”ë¥¸ ëª…ë ¹ì–´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. !íŒ€ [ë² í‹° ìº” DRX] í˜•íƒœë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.')
            return

        word_list = content[1].split()

        # ì…ë ¥í•œ ë‹¨ì–´ ê°œìˆ˜ í™•ì¸
        if len(word_list) < 3:
            await message.channel.send('âš ï¸ ì¸ì›ì´ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 3ëª… ì´ìƒì˜ ì¸ì›ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.')
            return

        # ë‹¨ì–´ë¥¼ ëœë¤í•˜ê²Œ ì„ íƒí•˜ì—¬ 3ê°œë¡œ ë‚˜ëˆ”
        random.shuffle(word_list)
        team_count = len(word_list) // 3
        remaining_words = len(word_list) % 3

        divided_words = [word_list[i*3:(i+1)*3] for i in range(team_count)]

        # ë‚¨ì€ ë‹¨ì–´ë¥¼ 2ê°œë¡œ ë‚˜ëˆ”
        if remaining_words == 2:
            divided_words.append(word_list[-2:])
        elif remaining_words == 1:
            divided_words.append(word_list[-1:])

        # ê²°ê³¼ ì¶œë ¥
        embed = discord.Embed(title="íŒ€ ë¶„ë°° ê²°ê³¼", color=discord.Color.teal())
        for i, words in enumerate(divided_words):
            words_str = ', '.join(words)
            embed.add_field(name=f"{i+1} Team", value=f'```{words_str}```', inline=False)
        await message.channel.send(embed=embed)


    if message.content.startswith('-ë§ˆ'):
        n = int(message.content.split()[1])

        words = [
            'ìŠ¤ë„¤ì´í¬ë§¨', 'ê²€ì€ìˆ˜ì—¼', 'ë‚˜ë¯¸', 'ë¡œìš°', 'ë£¨ì¹˜', 'ë¸Œë£©', 'ì‹œë¼í˜¸ì‹œ', 'í”„ë‘í‚¤', 'ì•„ì¹´ì´ëˆ„', 'í‚¤ìë£¨', 
            'ì•„ì˜¤í‚¤ì§€', 'ìƒ¹í¬ìŠ¤', 'ìƒë””', 'íƒ€ì‹œê¸°', 'í‚¤ë“œ', 'ë“œë˜ê³¤', 'ë¹…ë§˜', 'ì„¼ê³ ì¿ ', 'ì œíŠ¸', 'ì‹œí‚¤', 'ë¯¸í˜¸í¬', 'ì—ì´ìŠ¤', 'í•¸ì½•', 'ì˜¤ë…', 'ë ˆë“œí•„ë“œ', 'ì‹œë…¸ë¶€', 'ì—ë„¬'
        ]

        selected_words = random.sample(words, n)

        embed = discord.Embed(title='ğŸ—¸ ë§ˆë€ ë°´ì‚´ ê²°ê³¼', color=discord.Color.red())
        embed.description = ' '.join(selected_words)
        await message.channel.send(embed=embed)


    if message.content.startswith('-ë¬¼'):
        n = int(message.content.split()[1])

        words = [
            'ë„í”Œë¼ë°ê³ ', 'ë¡œë¹ˆ', 'ë£¨í”¼', 'ë°”ì§ˆí˜¸í‚¨ìŠ¤', 'ì‚¬ë³´', 'ìš°ì†', 'ì¡°ë¡œ', 'ì§•ë² ', 'ìµ¸íŒŒ', 'í›„ì§€í† ë¼', 
            'ë£Œì¿ ê·œ', 'ì•¼ë§ˆí† ', 'ì¹´íƒ€ì¿ ë¦¬', 'í‚¹', 'í¬ë¡œì»¤ë‹¤ì¼', 'ë ˆë² ì¹´', 'í°ìˆ˜ì—¼', 'ë¡œì ¸', 'ê±°í”„', 'ë ˆì¼ë¦¬', 'ì¹´ì´ë„', 'ë²„ê¸°', 'ì¹´ë²¤ë”§ìŠˆ'
        ]

        selected_words = random.sample(words, n)

        embed = discord.Embed(title='ğŸ—¸ ë¬¼ë€ ë°´ì‚´ ê²°ê³¼', color=discord.Color.blue())
        embed.description = ' '.join(selected_words)
        await message.channel.send(embed=embed)

    if '-ë„ì›€ë§' in message.content:
        embed = discord.Embed(title='â” ë„ì›€ë§', color=discord.Color.gold())
        embed.description = '```\n-ë¬¼ [ìˆ«ì]\n-ë§ˆ [ìˆ«ì]\n-ë‹¤ì´ìŠ¤\n-íŒ€\n-ë­í‚¹```'
        await message.channel.send(embed=embed)

    if message.content == '-ë‹¤ì´ìŠ¤':
        random_number = random.randint(1, 100)

        embed = discord.Embed(title='ğŸ² ë‹¤ì´ìŠ¤ ê²°ê³¼', color=discord.Color.green())
        embed.add_field(name=' ', value=str(random_number), inline=False)
        await message.channel.send(embed=embed)


    # í¬ì¸íŠ¸ ì§€ê¸‰ ëª…ë ¹ì–´
    if message.content.startswith(f'{PREFIX}ì§€ê¸‰'):
        nickname, points = message.content.split(' ', 2)[1:]

        if nickname in user_points:
            current_points = user_points[nickname]
        else:
            current_points = 0

        points = int(points)
        total_points = current_points + points
        user_points[nickname] = total_points

        await message.channel.send(f'{nickname}, ì ìˆ˜ê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ì ìˆ˜: {total_points}')

    if message.content.startswith('-ì§€ê¸‰'):
        content = message.content.split(' ', 2)
        if len(content) != 3:
            await message.channel.send('ì˜¬ë°”ë¥¸ ëª…ë ¹ì–´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. -ì§€ê¸‰ [ì‚¬ìš©ì] [ì ìˆ˜] í˜•íƒœë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.')
            return

        user = content[1]
        points = int(content[2])

        
        # ì‚¬ìš©ì ì ìˆ˜ ê°±ì‹ 
        if user in user_points:
            user_points[user] += points
        else:
            user_points[user] = points

        await message.channel.send(f'{user}ì—ê²Œ {points}ì ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.')

    elif message.content.startswith('-ì¡°íšŒ'):
        content = message.content.split(' ', 1)
        if len(content) != 2:
            await message.channel.send('ì˜¬ë°”ë¥¸ ëª…ë ¹ì–´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. -ì¡°íšŒ [ì‚¬ìš©ì] í˜•íƒœë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.')
            return

        user = content[1]

        # ì‚¬ìš©ì ì ìˆ˜ ì¡°íšŒ
        if user in user_points:
            points = user_points[user]
            await message.channel.send(f'{user}ì˜ ì ìˆ˜ëŠ” {points}ì ì…ë‹ˆë‹¤.')
        else:
            await message.channel.send(f'{user}ì˜ ì ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')


    elif message.content == '-ë­í‚¹':
        # ë­í‚¹ í‘œì‹œ
        sorted_users = sorted(user_points.items(), key=lambda x: x[1], reverse=True)
        ranking = []
        for i, (user, points) in enumerate(sorted_users[:8], start=1):
            if i <= 3:
                emoji = ":crown:" if i == 1 else ":trophy:" if i == 2 else ":military_medal:"
                ranking.append(f"{emoji} {user} - {points}ì ")
            else:
                ranking.append(f"{i}ë“± {user} - {points}ì ")
        
        embed = discord.Embed(title="ë­í‚¹ TOP 8", color=0xffd700)
        embed.description = "\n".join(ranking)
        await message.channel.send(embed=embed)

@client.event
async def on_member_join(member):
    # ìƒˆë¡œìš´ ë©¤ë²„ê°€ ë“¤ì–´ì™”ì„ ë•Œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ

    # í™˜ì˜ ë©”ì‹œì§€ ì‘ì„±
    welcome_message = f'**ğŸ‰ {member.mention} ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!**'
    welcome_message += '\nì„œë²„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. í•¨ê»˜ ì¦ê±°ìš´ ì‹œê°„ ë³´ë‚´ìš”!'

    # ì„ë² ë“œ ìƒì„±
    embed = discord.Embed(title='ì„œë²„ ì…ì¥', description=welcome_message, color=0x00ff00)

    # ì±„ë„ ì°¾ê¸° (ë©”ì‹œì§€ë¥¼ ì—…ë¡œë“œí•  ì±„ë„ì˜ ID ë˜ëŠ” ì´ë¦„ì„ ì§€ì •í•´ì£¼ì„¸ìš”)
    channel_id = 835570354830442528  # ì—…ë¡œë“œí•  ì±„ë„ì˜ ID
    channel = client.get_channel(channel_id)

    # í™˜ì˜ ë©”ì‹œì§€ ì—…ë¡œë“œ
    await channel.send(embed=embed)

# ë””ìŠ¤ì½”ë“œ ë´‡ í† í°ì„ ì…ë ¥í•©ë‹ˆë‹¤.
    client.run(token)